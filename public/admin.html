<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body { font-family: Arial; margin: 40px; }
table { border-collapse: collapse; width: 80%; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
button { padding: 5px 10px; }
</style>
</head>
<body>
<h1>Admin Panel</h1>
<input type="password" id="secret" placeholder="Enter Admin Secret">
<button onclick="loadMessages()">Load Messages</button>
<table id="messages" style="margin-top:20px;">
<thead>
<tr><th>ID</th><th>Name</th><th>Message</th><th>Created At</th><th>Action</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
async function loadMessages() {
  const secret = document.getElementById('secret').value;
  const tbody = document.querySelector('#messages tbody');
  tbody.innerHTML = '';

  if (!secret.trim()) return alert('Admin secret required');

  const res = await fetch(`/api/list?admin_secret=${secret}`);
  const data = await res.json();

  if (res.ok) {
    data.forEach(msg => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${msg.id}</td>
        <td>${msg.name || ''}</td>
        <td>${msg.message}</td>
        <td>${new Date(msg.created_at).toLocaleString()}</td>
        <td><button onclick="deleteMessage(${msg.id}, '${secret}')">Delete</button></td>
      `;
      tbody.appendChild(row);
    });
  } else {
    alert('Error: ' + data.error);
  }
}

async function deleteMessage(id, secret) {
  if (!confirm('Are you sure you want to delete this message?')) return;
  const res = await fetch('/api/delete', {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, admin_secret: secret })
  });
  const data = await res.json();
  if (res.ok) loadMessages();
  else alert('Error: ' + data.error);
}
</script>
</body>
</html>
